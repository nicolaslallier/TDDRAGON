# Release v0.3.0 - Log Viewer UI

## Overview

Version 0.3.0 introduces a web-based user interface for querying and visualizing Nginx access logs and uptime data stored in PostgreSQL. The UI provides filtering, pagination, charts, and CSV export functionality.

## Features

### Access Logs Viewer
- Filter logs by time range (start/end datetime)
- Filter by HTTP status code
- Filter by URI (substring match)
- Filter by client IP address
- Paginated table display (25, 50, or 100 rows per page)
- Sortable columns (timestamp, status code)
- Real-time filtering with HTMX (no full page reload)

### Uptime Viewer
- Period selector (defaults to last 24 hours)
- List of UP/DOWN records with timestamps
- Uptime percentage calculation and display
- Timeline chart showing UP/DOWN periods over time

### Charts and Visualizations
- HTTP status code histogram (bar chart using Chart.js)
- Uptime timeline (line chart showing UP/DOWN status over time)

### CSV Export
- Export filtered access logs to CSV format
- Respects all active filters (time range, status code, URI, IP)
- Download via HTTP response with proper headers

### Authentication
- Mock authentication system (placeholder for v0.3.0)
- Session-based authentication
- Protected routes require login
- Mock credentials:
  - `admin` / `admin123`
  - `operator` / `operator123`
  - `viewer` / `viewer123`

## Technical Implementation

### Architecture
- **UI Technology**: FastAPI with HTMX for dynamic updates
- **Templates**: Jinja2 templates with partials for HTMX responses
- **Charts**: Chart.js for client-side visualizations
- **Authentication**: Mock session-based authentication
- **Endpoint**: Independent `log_viewer` endpoint (port 8002)

### New Dependencies
- `jinja2>=3.1.0` - Template engine
- `python-multipart>=0.0.6` - Form handling
- `itsdangerous>=2.1.0` - Session management

### Database
- Uses existing `nginx_access_logs_ts` and `nginx_uptime_ts` tables from v0.2.0
- No new migrations required

## Docker Configuration

### New Service: `log-viewer`
- **Image**: Built from `docker/log-viewer/Dockerfile`
- **Port**: 8002
- **Environment Variables**:
  - `DATABASE_URL` - PostgreSQL connection string
  - `API_HOST` - Server host (default: 0.0.0.0)
  - `API_PORT` - Server port (default: 8002)
  - `SESSION_SECRET_KEY` - Secret key for session management

### Nginx Configuration
- Added routes for `/log-viewer` and `/static` to proxy to log-viewer service
- Accessible via `http://localhost/log-viewer/` when running with docker-compose

## Testing

### Test Coverage
- **Unit Tests**: 100% coverage for application layer
- **Integration Tests**: UI flows, HTMX endpoints, CSV export
- **E2E Tests**: All acceptance criteria (AT-301 to AT-305)
- **Regression Tests**: UI components and edge cases

### Acceptance Criteria (AT-3XX)
- **AT-301**: Filter by period and HTTP code ✓
- **AT-302**: Filter by URI and IP ✓
- **AT-303**: Uptime summary ✓
- **AT-304**: CSV export ✓
- **AT-305**: Read-only access ✓

## Usage

### Starting the Server

**Directly**:
```bash
python -m src.endpoints.log_viewer.main
```

**With Docker Compose**:
```bash
docker-compose up log-viewer
```

### Accessing the UI

**Via Nginx** (docker-compose):
- Login: `http://localhost/log-viewer/login`
- Access Logs: `http://localhost/log-viewer/access-logs`
- Uptime: `http://localhost/log-viewer/uptime`

**Directly**:
- Login: `http://localhost:8002/log-viewer/login`
- Access Logs: `http://localhost:8002/log-viewer/access-logs`
- Uptime: `http://localhost:8002/log-viewer/uptime`

## Known Limitations

1. **Mock Authentication**: Authentication is a placeholder implementation. Real authentication should be implemented in a future version.
2. **No User Management**: No user creation, deletion, or role management in v0.3.0.
3. **Read-Only Interface**: The UI is read-only - no modification or deletion operations are available (by design).

## Future Enhancements

- Real authentication system (SSO, OAuth, etc.)
- User management and role-based access control
- Additional chart types (response time distribution, request rate over time)
- Advanced filtering options (regex patterns, multiple status codes)
- Saved filter presets
- User activity logging for audit purposes

## Breaking Changes

None - this is a new endpoint, no breaking changes to existing endpoints.

## Migration Notes

No database migrations required. The log_viewer endpoint uses existing tables from v0.2.0.

## Files Changed

### New Files
- `src/endpoints/log_viewer/` - Complete new endpoint
- `docker/log-viewer/Dockerfile` - Docker configuration
- `tests/endpoints/log_viewer/` - Test suites

### Modified Files
- `docker-compose.yml` - Added log-viewer service
- `docker/nginx/nginx.conf` - Added routes for log-viewer
- `requirements.txt` - Added jinja2, python-multipart, itsdangerous
- `README.md` - Added log_viewer endpoint documentation

## Contributors

- Implementation completed following TDD principles
- All acceptance criteria met and tested

